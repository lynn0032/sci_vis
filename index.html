<html>
<script src = 'https://d3js.org/d3.v5.min.js'></script>
<script src="https://unpkg.com/d3-simple-slider"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>

<body onload = 'init()'>
	<h1> Understanding the \(k\)-Nearest Neighbors Classification Algorithm </h1>
	<p> The \(k\)-nearest neighbor algorithm blah blah blah </p>
	<p> Given a set a labeled datapoints and a new point to classify,
		<ul>
			<li>Find the \(k\) labeled data points which are closest to the new point</li>
			<li>Those \(k\) labeled data points "vote" on which label to give the new point</li>
			<li>The new point is labeled with the most frequent label amongst the neighbors</li>
	</ul></p>
	<p> About the data breast cancer</p>
  
  <svg width=960 height=500>
	  
	  <rect x=10 y=10 width=350 height=40 style="stroke-width:1;stroke:black;fill-opacity:.1"></rect>
	  <text x=25 y=40 font-family="Verdana" font-size="20" fill="black"> Visualizing k-Nearest Neighbors </text>


	</svg>
	
<script>
	var k = '1';
	
	function draw_axes(){
		//code in this function is adapted from: https://www.tutorialsteacher.com/d3js/axes-in-d3
		
		var width = 480, height = 440;

		var svg = d3.select('svg');

		var x_ticks = [0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24];
		var xscale = d3.scaleLinear().domain([d3.min(x_ticks), d3.max(x_ticks)]).range([0, 9*width/10]);

		var y_ticks = [0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22];
		var yscale = d3.scaleLinear().domain([d3.min(y_ticks), d3.max(y_ticks)]).range([9*height/10, 0]);

		var x_axis = d3.axisBottom().scale(xscale);

		var y_axis = d3.axisLeft().scale(yscale);

    		svg.append("g").attr("transform", "translate(50, 80)").call(y_axis);

		var xAxisTranslate = 9*height/10 + 80;

    		svg.append("g").attr("transform", "translate(50, " + xAxisTranslate  +")").call(x_axis);

	}
	
	function make_legend(){
		window.legend = d3.select("body").append("div").style("position", "absolute").style("visibility", "visible")
			.style("left", "500px").style("top", "650px").style("border", "solid").style("border-width", "1px")
			.style("border-radius", "5px").style("padding", "5px").style("font-family", "Verdana").style("font-size", "11");
		window.legend_circle1 = d3.select('svg').append('circle').attr("cx", "507").attr("cy", "421").attr("r", "5");
		window.legend_circle2 = d3.select('svg').append('circle').attr("cx", "507").attr("cy", "436").attr("r", "5");
		legend.html("&nbsp&nbsp&nbsp&nbsp Malignant Tumor<br>&nbsp&nbsp&nbsp&nbsp Benign Tumor");
		legend_circle1.style("fill", "orange").style("fill-opacity", ".5");
		legend_circle2.style("fill", "blue").style("fill-opacity", ".5");
	}
	
	function classification(letter){
		if (letter == "M") {return "Malignant";}
		else {return "Benign";}
	}
	
	function tooltip_text(d){
		tooltip.html("Coordinates: (" + d['pc1'].slice(0,5) + ", " + d['pc2'].slice(0,5) + ") <br> Classification: " + classification(d['diagnosis']));
	}
	
	async function init(){
		
		draw_axes();
		make_legend();
		
		//slider
		var slider = d3.sliderHorizontal().min(1).max(569).step(1).width(300).ticks(10).displayValue(true).value(1)
			.on('onchange', (val) => { k = d3.format('.1f')(val);});
		d3.select('svg').append('g').attr('transform', 'translate(500,80)').call(slider);
		
		//plot data points
		const data = await d3.csv("https://raw.githubusercontent.com/lynn0032/sci_vis/master/bc_data.csv");
		window.points = d3.select('svg').append("g").attr("transform", "translate(50, 80)").selectAll('circle').data(data).enter().append('circle')
			.attr("cx", function(d){return 18*(parseFloat(d.pc1)+6);})
			.attr("cy",function(d){return 396-18*(parseFloat(d.pc2)+8);})
			.style("fill", function(d){if (d.diagnosis=="B") {return "blue";} else {return "orange";}})
			.attr("r", 3).style("fill-opacity", ".5");
		
		//tooltip
		window.tooltip = d3.select("body").append("div").attr("class", "tooltip").style("position", "absolute")
			.style("visibility", "hidden").style("background-color", "white").style("border", "solid").style("border-width", "1px")
			.style("border-radius", "5px").style("padding", "10px");
		points.on("mouseover", function(d){
			d3.select(this).style("stroke", "black").style("stroke-opacity", "1");
		tooltip_text(d);
		tooltip.style("visibility", "visible").style("left", (d3.event.pageX) + "px").style("top", (d3.event.pageY) + "px");});
		points.on("mouseout", function(){
			d3.select(this).style("stroke-opacity", "0");
			tooltip.style("visibility", "hidden");});
        
	}
	
	</script>
	

  </body>

</html>
